<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#141414">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192.PNG">

  <title>PG Daily Log</title>

  <style>
    :root{
      --bg:#0f0f0f;
      --card:#141414;
      --border:#2a2a2a;
      --muted:#a8a8a8;
      --text:#f2f2f2;
      --accent:#ff5ca8;
      --good:#22c55e;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:16px;
      --radius2:14px;
      --pad:16px;
      --gap:12px;
      --field:#0f0f0f;
    }

    /* Page system */
    .page { display: none; }
    .page.active { display: block; }

    .expWrap{ margin-top:14px; }
    .expToggle{ display:flex; align-items:center; gap:10px; cursor:pointer; }
    .expToggle input{ transform:scale(1.1); }

    .expPanel{ display:none; margin-top:10px; }
    .expPanel.show{ display:block; }

    .expGrid{
      display:grid;
      grid-template-columns: 110px 1fr;
      gap:12px 12px;
      align-items:center;
    }
    .expRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:center;
      margin-top:8px;
    }
    .expHeadCell{
      color: var(--muted);
      font-size:13px;
      font-weight:700;
    }
    @media (max-width:420px){
      .expRow{ grid-template-columns:1fr; }
    }

    .expInput{
      width:100%;
    }
    @media (max-width:420px){
      .expRow{ grid-template-columns: 90px 1fr; }
      .expLabel{ font-size:14px; }
    }

    .skuGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:end;
    }
    @media (max-width:420px){
      .skuGrid{ grid-template-columns: 1fr 1fr; }
    }
    .closedBox .btns{ display:flex; gap:10px; justify-content:flex-start; }
    .closedBox label{ margin-top:0; }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,#0b0b0b 0%, #0f0f0f 40%, #0b0b0b 100%);
      color:var(--text);
      font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      padding: calc(18px + env(safe-area-inset-top)) 16px 14px;
      background:rgba(10,10,10,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    header .title{
      font-size:22px;
      font-weight:800;
      letter-spacing:.2px;
    }

    main{padding:16px; max-width: 860px; margin: 0 auto 28px;}

    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      margin: 12px 0;
    }
    .card h2{
      margin:0 0 10px;
      font-size:20px;
      font-weight:800;
    }
    .subline{
      margin: 0 0 10px;
      color:var(--muted);
      font-size:13px;
    }
    .divider{
      height:1px;
      background:rgba(255,255,255,.07);
      margin: 12px 0;
    }

    label{
      display:block;
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }

    input:not([type="checkbox"]):not([type="radio"]), select, textarea{
      width:100%;
      margin-top:6px;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:var(--field);
      color:var(--text);
      outline:none;
    }
    textarea{min-height:70px; resize:vertical}
    
    /* Date field style for readonly */
    input[readonly]{
      background:#1a1a1a;
      border-color:#333;
      color:#888;
      cursor:not-allowed;
    }
    
    /* Date format input */
    .date-input {
      letter-spacing: 1px;
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    .row3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    @media (max-width: 560px){
      .row2,.row3{grid-template-columns:1fr}
    }

    /* Operation buttons */
    .operationWrap{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background:#101010;
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:all 0.2s;
    }
    .pill:hover{
      background:#1a1a1a;
    }
    .pill.active{
      border-color: rgba(255,92,168,.55);
      background:rgba(255,92,168,.12);
      box-shadow: 0 0 0 3px rgba(255,92,168,.12);
    }

    /* Focus SKU */
    .skuBlock{
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:14px;
      margin-top:12px;
      background:rgba(0,0,0,.18);
    }
    .skuTitle{
      font-size:18px;
      font-weight:800;
      margin:0 0 10px;
    }

    .seg{
      display:flex;
      gap:8px;
      align-items:center;
      margin-top:6px;
    }
    .seg label{margin:0; font-size:13px; color:var(--muted)}
    .seg .segBtns{
      display:flex;
      gap:8px;
    }
    .segBtn{
      border:1px solid rgba(255,255,255,.12);
      background:#0f0f0f;
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
      min-width:72px;
      text-align:center;
      transition:all 0.2s;
    }
    .segBtn:hover{
      background:#1a1a1a;
    }
    .segBtn.active{
      border-color: rgba(255,92,168,.55);
      background:rgba(255,92,168,.12);
      box-shadow: 0 0 0 3px rgba(255,92,168,.12);
    }

    /* Delivery expiry */
    .hint{color:var(--muted); font-size:13px; margin: 6px 0 10px;}

    @media (max-width: 720px){
      .deliveryRow{
        grid-template-columns: 110px 1fr;
      }
      .expLabel{padding-top:0}
    }

    /* Checklist */
    .checkItem{
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:14px;
      margin-top:12px;
      background:rgba(0,0,0,.18);
    }

    .checkHeader{
      display:grid;
      grid-template-columns: 28px 1fr;
      gap:10px;
      align-items:start;
    }

    .checkMain{
      width:22px;
      height:22px;
      margin-top:2px;
      accent-color: #3b82f6;
      cursor:pointer;
    }

    .checkTitleRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .checkTitle{
      font-size:22px;
      font-weight:900;
      margin:0;
      line-height:1.1;
    }
    .status{
      color:var(--muted);
      font-size:13px;
      margin-top:6px;
    }

    .detailsBox{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.18);
      background:rgba(0,0,0,.14);
    }
    .detailsHead{
      color:var(--muted);
      font-size:13px;
      margin:0 0 10px;
      font-weight:700;
    }

    /* All details in 2-column grid */
    .detailsGrid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
    }
    @media (max-width: 560px){
      .detailsGrid{grid-template-columns:1fr}
    }
#pageOpening #env_details {
  grid-template-columns: 1fr 1fr;
}

@media (max-width: 560px) {
  #pageOpening #env_details {
    grid-template-columns: 1fr 1fr;
  }
}
    .dRow{
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background:#0f0f0f;
    }
    .dRow input[type="checkbox"]{
      width:18px;
      height:18px;
      margin:0;
      flex:0 0 auto;
      accent-color:#e5e7eb;
      cursor:pointer;
    }
    .dRow span{
      color:var(--text);
      font-size:14px;
      line-height:1.2;
    }
    
    /* Cleaning reminder style */
    .cleaningReminder{
      margin-top:10px;
      color:#a0a0a0;
      font-size:13px;
      font-style:italic;
    }
    
    /* Freezer issue sub-options */
    .subOptions {
      margin-top: 10px;
      padding-left: 20px;
      border-left: 2px solid rgba(255,255,255,0.1);
    }
    
    .subOptions .dRow {
      background: rgba(0,0,0,0.2);
      margin-bottom: 5px;
    }
    
    .otherInput {
      margin-top: 8px;
      margin-left: 28px;
    }

    .inlineBlock{
      margin-top:10px;
      display:grid;
      grid-template-columns: 28px 1fr;
      gap:10px;
      align-items:center;
    }
    .inlineBlock input[type="checkbox"]{
      width:18px; height:18px; margin:0;
      accent-color:#e5e7eb;
      cursor:pointer;
    }
    .inlineBlock .inlineLabel{
      font-size:14px;
      color:var(--text);
      font-weight:800;
    }

    .noteInput{
      margin-top:8px;
    }

    /* Cash */
    .cashGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:end;
    }
    @media (max-width: 560px){
      .cashGrid{grid-template-columns:1fr 1fr}
    }
    .diffRow{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:#0f0f0f;
    }
    .diffLabel{
      color:var(--muted);
      font-size:13px;
      font-weight:800;
    }
    .diffValue{
      font-size:16px;
      font-weight:900;
      color:var(--accent);
    }

    /* Footer buttons */
    .btnRow{
      display:flex;
      gap:10px;
      margin-top:14px;
    }
    .btn{
      flex:1;
      border:none;
      border-radius:14px;
      padding:14px 14px;
      font-weight:900;
      font-size:16px;
      cursor:pointer;
      transition:all 0.2s;
    }
    .btn.secondary{
      background:#232323;
      color:#fff;
      border:1px solid rgba(255,255,255,.10);
      flex: .7;
    }
    .btn.secondary:hover{
      background:#2a2a2a;
    }
    .btn.primary{
      background:var(--good);
      color:#041006;
      box-shadow: 0 10px 22px rgba(34,197,94,.22);
    }
    .btn.primary:hover{
      background:#16a34a;
      transform:translateY(-2px);
    }
    .smallHelp{
      margin-top:10px;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.35;
    }
    
    /* Mid shift checklist items */
    .mid-checklist-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
    }
    
#pageMid section.card {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}


@media (max-width: 560px) {
  #pageMid section.card {
    grid-template-columns: 1fr 1fr;
  }
}
    .mid-checklist-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #3b82f6;
    }
    
    .mid-checklist-label {
      flex: 1;
      font-size: 16px;
      font-weight: 600;
    }
    
    .mid-time {
      font-size: 13px;
      color: var(--muted);
      min-width: 100px;
      text-align: right;
    }
    
    /* Closing section */
    .closing-reminder {
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
      font-style: italic;
    }
  </style>
</head>

<body>
  <!-- Page 1: Operation Selection -->
  <div id="page1" class="page active">
    <header>
      <div class="title">PG Daily Log</div>
    </header>

    <main>
      <section class="card">
        <h2>Operational Record</h2>

        <div class="row2">
          <div>
            <label for="store">Store</label>
            <select id="store">
              <option value="490 Bergen St">490 Bergen St</option>
              <option value="1562 1st Ave">1562 1st Ave</option>
            </select>
          </div>

          <div>
            <label for="date">Date</label>
            <input id="date" type="text" class="date-input" readonly />
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="name">Name</label>
            <input id="name" type="text" placeholder="Your name" autocomplete="off" />
          </div>

          <div>
            <label>Log Check-in</label>
            <div class="operationWrap" role="group" aria-label="Select Time Slot">
              <div class="pill" data-operation="opening">Opening (09:40–10:20am)</div>
              <div class="pill" data-operation="mid">12–4pm</div>
              <div class="pill" data-operation="closing">Closing (7:40–9:20pm)</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Page 2: Opening Operation -->
  <div id="pageOpening" class="page">
    <header>
      <div class="title">PG Daily Log - Opening</div>
      <div style="font-size: 13px; color: var(--muted); margin-top: 4px;" id="openingHeaderInfo"></div>
    </header>

    <main>
     
      <!-- Checklist -->
      <section class="card">
        <h2>Checklist</h2>

        <!-- Environment -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="env_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Environment Ready</div>
              </div>
              <div class="status" id="env_status">Not done</div>

              <div class="detailsBox">
                <div class="detailsHead">check below if down</div>
                <div class="detailsGrid" id="env_details">
                  <label class="dRow"><input type="checkbox" data-detail="env" value="Music"><span>Music issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="env" value="Lights"><span>Lights issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="env" value="AC/Heat"><span>AC/Heat issue</span></label>
                  <label class="dRow"><input type="checkbox" id="freezer_issue" data-detail="env" value="Freezer"><span>Freezer issue</span></label>
                </div>
                
                <!-- Freezer issue sub-options -->
                <div id="freezer_suboptions" class="subOptions" style="display: none;">
                  <label class="dRow"><input type="radio" name="freezer_problem" value="door not sealed"><span>Door not sealed</span></label>
                  <label class="dRow"><input type="radio" name="freezer_problem" value="temp abnormal"><span>Temp abnormal</span></label>
                  <label class="dRow"><input type="radio" name="freezer_problem" value="totally down"><span>Totally down</span></label>
                  <label class="dRow"><input type="radio" name="freezer_problem" value="other"><span>Other</span></label>
                  <input type="text" id="freezer_other_text" class="otherInput" placeholder="Specify other issue" style="display: none;">
                </div>

                <div class="detailsGrid" style="margin-top:12px;">
                  <label class="dRow">
                    <input type="checkbox" id="label_missing_chk">
                    <span>Label missing</span>
                  </label>

                  <input
                    id="label_missing_text"
                    type="text"
                    placeholder="eg, FD duck head, poop bag, etc"
                    disabled
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- System -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="sys_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">System Ready</div>
              </div>
              <div class="status" id="sys_status">Not done</div>

              <div class="detailsBox">
                <div class="detailsHead">check below if down</div>
                <div class="detailsGrid" id="sys_details">
                  <label class="dRow"><input type="checkbox" data-detail="sys" value="Phone"><span>Phone issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="sys" value="WiFi"><span>WiFi issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="sys" value="POS"><span>POS issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="sys" value="Printer"><span>Printer issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="sys" value="Receipt printer"><span>Receipt printer issue</span></label>
                  <label class="dRow"><input type="checkbox" data-detail="sys" value="Barcode scanner"><span>Barcode scanner issue</span></label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Cleaning -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="clean_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Cleanliness Check</div>
              </div>
              <div class="status" id="clean_status">Not done</div>

              <div class="detailstext">
                <div class="closing-reminder">
  Reminder: Window, Floor, Restroom, Counter
</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bin, Shelf & Freezer Ready -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="bsf_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Bin, Shelf &amp; Freezer Ready</div>
              </div>
              <div class="status" id="bsf_status">Not done</div>
            </div>
          </div>
        </div>
        <!-- Delivery expiry check -->
      <div class="card expWrap">
        <h2>Today's Receiving Status</h2>
        <div class="subline">Expiry Check Scope: Food, Topper, Treats, Supplement</div>

        <label class="expToggle">
          <input type="checkbox" id="exp_hasIssue">
          <span>Found items with EXP ≤ 8 months</span>
        </label>

        <div id="exp_panel" class="expPanel">
          <div class="expRow expHead" style="margin-top:10px;">
            <div class="expHeadCell">SKU</div>
            <div class="expHeadCell">EXP mm/dd/yyyy</div>
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku1" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp1" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku2" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp2" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku3" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp3" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku4" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp4" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku5" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp5" placeholder="" autocomplete="off">
          </div>
        </div>
      </div>
      </section>

      <!-- Submit button -->
      <section class="card">
        <div class="btnRow">
          <button class="btn secondary" type="button" id="btnBackOpening">Back</button>
          <button class="btn primary" type="button" id="btnSendOpening">Submit to WhatsApp</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Page 3: Mid Operation (12-5pm) -->
  <div id="pageMid" class="page">
    <header>
      <div class="title">PG Daily Log - 12–5pm</div>
      <div style="font-size: 13px; color: var(--muted); margin-top: 4px;" id="midHeaderInfo"></div>
    </header>

    <main>
       <!-- Focus SKUs -->
      <section class="card" id="focusSKUs">
        <h2>Focus SKUs</h2>

        <div class="skuBlock">
          <div class="skuTitle">SKU 1</div>
          <div class="skuGrid">
            <div>
              <label for="fp1_reco">Recommend Times</label>
              <input id="fp1_reco" type="number" inputmode="numeric" min="0" value="0" />
            </div>

            <div class="closedBox">
  <label>Closed</label>
  <select class="closedSelect" data-seg="fp1_closed">
    <option value="No" selected>No</option>
    <option value="Yes">Yes</option>
  </select>
</div>
          </div>
        </div>

        <div class="skuBlock">
          <div class="skuTitle">SKU 2</div>
          <div class="skuGrid">
            <div>
              <label for="fp2_reco">Recommend Times</label>
              <input id="fp2_reco" type="number" inputmode="numeric" min="0" value="0" />
            </div>

            <div class="closedBox">
  <label>Closed</label>
  <select class="closedSelect" data-seg="fp2_closed">
    <option value="No" selected>No</option>
    <option value="Yes">Yes</option>
  </select>
</div>
          </div>
        </div>

        <div class="skuBlock">
          <div class="skuTitle">SKU 3</div>
          <div class="skuGrid">
            <div>
              <label for="fp3_reco">Recommend Times</label>
              <input id="fp3_reco" type="number" inputmode="numeric" min="0" value="0" />
            </div>

            <div class="closedBox">
  <label>Closed</label>
  <select class="closedSelect" data-seg="fp3_closed">
    <option value="No" selected>No</option>
    <option value="Yes">Yes</option>
  </select>
</div>
          </div>
        </div>
      </section>

       <div class="card expWrap">
        <h2>Today's Receiving Status</h2>
        <div class="subline">Expiry Check Scope: Food, Topper, Treats, Supplement</div>

       <label class="expToggle">
  <input type="checkbox" id="exp_hasIssue_mid">
  <span>Found items with EXP ≤ 8 months</span>
</label>

<div id="exp_panel_mid" class="expPanel">
          <div class="expRow expHead" style="margin-top:10px;">
            <div class="expHeadCell">SKU</div>
            <div class="expHeadCell">EXP mm/dd/yyyy</div>
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku1" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp1" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku2" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp2" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku3" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp3" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku4" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp4" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku5" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp5" placeholder="" autocomplete="off">
          </div>
        </div>
      </div>
      <section class="card">
        <h2>Checklist</h2>
        
        <div class="mid-checklist-item">
          <input type="checkbox" id="mid_bin">
          <div class="mid-checklist-label">Bin Reorganized</div>
          <div class="mid-time" id="mid_bin_time"></div>
        </div>
        
        <div class="mid-checklist-item">
          <input type="checkbox" id="mid_shelf">
          <div class="mid-checklist-label">Shelf Reorganized</div>
          <div class="mid-time" id="mid_shelf_time"></div>
        </div>
        
        <div class="mid-checklist-item">
          <input type="checkbox" id="mid_freezer">
          <div class="mid-checklist-label">Freezer Reorganized</div>
          <div class="mid-time" id="mid_freezer_time"></div>
        </div>
        
        <div class="mid-checklist-item">
          <input type="checkbox" id="mid_floor">
          <div class="mid-checklist-label">Floor Cleaned</div>
          <div class="mid-time" id="mid_floor_time"></div>
        </div>
        
        <div class="mid-checklist-item">
          <input type="checkbox" id="mid_counter">
          <div class="mid-checklist-label">Counter Cleaned</div>
          <div class="mid-time" id="mid_counter_time"></div>
        </div>
        
        <div class="mid-checklist-item">
          <input type="checkbox" id="mid_freezers_working">
          <div class="mid-checklist-label">Freezers Normal</div>
          <div class="mid-time" id="mid_freezers_working_time"></div>
        </div>
      </section>

      <!-- Submit button -->
      <section class="card">
        <div class="btnRow">
          <button class="btn secondary" type="button" id="btnBackMid">Back</button>
          <button class="btn primary" type="button" id="btnSendMid">Submit to WhatsApp</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Page 4: Closing Operation -->
  <div id="pageClosing" class="page">
    <header>
      <div class="title">PG Daily Log - Closing</div>
      <div style="font-size: 13px; color: var(--muted); margin-top: 4px;" id="closingHeaderInfo"></div>
    </header>

    <main>
      <!-- Focus SKUs for closing -->
      <section class="card" id="focusSKUsClosing">
        <h2>Focus SKUs</h2>

        <div class="skuBlock">
          <div class="skuTitle">SKU 1</div>
          <div class="skuGrid">
            <div>
              <label for="fp1_reco_closing">Recommend Times</label>
              <input id="fp1_reco_closing" type="number" inputmode="numeric" min="0" value="0" />
            </div>

            <div class="closedBox">
  <label>Closed</label>
  <select class="closedSelect" data-seg="fp1_closed">
    <option value="No" selected>No</option>
    <option value="Yes">Yes</option>
  </select>
</div>
          </div>
        </div>

        <div class="skuBlock">
          <div class="skuTitle">SKU 2</div>
          <div class="skuGrid">
            <div>
              <label for="fp2_reco_closing">Recommend Times</label>
              <input id="fp2_reco_closing" type="number" inputmode="numeric" min="0" value="0" />
            </div>

            <div class="closedBox">
  <label>Closed</label>
  <select class="closedSelect" data-seg="fp2_closed">
    <option value="No" selected>No</option>
    <option value="Yes">Yes</option>
  </select>
</div>
          </div>
        </div>

        <div class="skuBlock">
          <div class="skuTitle">SKU 3</div>
          <div class="skuGrid">
            <div>
              <label for="fp3_reco_closing">Recommend Times</label>
              <input id="fp3_reco_closing" type="number" inputmode="numeric" min="0" value="0" />
            </div>

            <div class="closedBox">
  <label>Closed</label>
  <select class="closedSelect" data-seg="fp3_closed">
    <option value="No" selected>No</option>
    <option value="Yes">Yes</option>
  </select>
</div>
          </div>
        </div>
      </section>

      <!-- Checklist for Closing -->
      <section class="card">
        <h2>Checklist</h2>

        <!-- Things OFF -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="things_off_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Things OFF</div>
              </div>
              <div class="status" id="things_off_status">Not done</div>
              <div class="closing-reminder">Reminder: Music, Lights, AC/Heat, POS</div>
            </div>
          </div>
        </div>

        <!-- Freezer is on -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="freezer_on_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Freezers On</div>
              </div>
              <div class="status" id="freezer_on_status">Not done</div>
            </div>
          </div>
        </div>

        <!-- Freezers not working -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="freezers_not_working_main" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Freezers Abnormal</div>
              </div>
              <div class="status" id="freezers_not_working_status">Not done</div>
            </div>
          </div>
        </div>

        <!-- Trash Out -->
        <div class="checkItem">
          <div class="checkHeader">
            <input class="checkMain" type="checkbox" id="trash_main_closing" />
            <div>
              <div class="checkTitleRow">
                <div class="checkTitle">Trash Out</div>
              </div>
              <div class="status" id="trash_status_closing">Not done</div>
            </div>
          </div>
        </div>
        <!-- Supplies Check -->
      <div class="checkItem">
        <div class="checkHeader">
          <input class="checkMain" type="checkbox" id="sup_main_closing" />
          <div>
            <div class="checkTitleRow">
              <div class="checkTitle">Supplies Check</div>
            </div>
            <div class="status" id="sup_status_closing">Not done</div>

            <div class="detailsBox">
              <div class="detailsHead">check below if apply</div>
              <div class="detailsGrid" id="sup_details_closing">
                <label class="dRow"><input type="checkbox" data-detail="sup" value="Receipt paper ≤ 3 rolls"><span>Receipt paper ≤ 3 rolls</span></label>
                <label class="dRow"><input type="checkbox" data-detail="sup" value="Printer cartridge ≤ 15%"><span>Printer cartridge ≤ 15%</span></label>
                <label class="dRow"><input type="checkbox" data-detail="sup" value="Price label = 1 roll"><span>Price label ≤ 1 roll</span></label>
                <label class="dRow"><input type="checkbox" data-detail="sup" value="Fabuloso need it in 3 days"><span>Fabuloso need it next week</span></label>
                <label class="dRow"><input type="checkbox" data-detail="sup" value="Trash Bag = 1 roll"><span>Trash Bag = 1 roll</span></label>
              </div>
            </div>
          </div>
        </div>
      </div>
      </section>

       <div class="card expWrap">
        <h2>Today's Receiving Status</h2>
        <div class="subline">Expiry Check Scope: Food, Topper, Treats, Supplement</div>

        <label class="expToggle">
  <input type="checkbox" id="exp_hasIssue_closing">
  <span>Found items with EXP ≤ 8 months</span>
</label>

<div id="exp_panel_closing" class="expPanel">
          <div class="expRow expHead" style="margin-top:10px;">
            <div class="expHeadCell">SKU</div>
            <div class="expHeadCell">EXP mm/dd/yyyy</div>
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku1" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp1" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku2" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp2" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku3" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp3" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku4" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp4" placeholder="" autocomplete="off">
          </div>

          <div class="expRow">
            <input class="expInput" id="exp_sku5" placeholder="" autocomplete="off">
            <input class="expInput date-format" id="exp_exp5" placeholder="" autocomplete="off">
          </div>
        </div>
      </div>

      <!-- Cash -->
      <section class="card">
        <h2>Cash</h2>

        <div class="cashGrid">
          <div>
            <label for="drawerCash">Drawer Cash ($)</label>
            <input id="drawerCash" type="number" inputmode="decimal" placeholder="" />
          </div>

          <div>
            <label for="systemCashSales">System Cash Sales ($)</label>
            <input id="systemCashSales" type="number" inputmode="decimal" placeholder="" />
          </div>
        </div>

        <div class="diffRow">
          <div class="diffLabel">Difference</div>
          <div class="diffValue" id="differenceValue">$0.00</div>
        </div>
      </section>

      <!-- Submit button -->
      <section class="card">
        <div class="btnRow">
          <button class="btn secondary" type="button" id="btnBackClosing">Back</button>
          <button class="btn primary" type="button" id="btnSendClosing">Submit to WhatsApp</button>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ---------------------------
    // Constants and Helpers
    // ---------------------------
    const WA_PHONE = "12122894416";
    const LS_NAME_KEY = "pg_dl_name_v1";
    const LS_STORE_KEY = "pg_dl_store_v1";
    
    // Store user data globally
    let userData = {
      store: "",
      date: "",
      name: "",
      operation: ""
    };

    function pad2(n){ return String(n).padStart(2,"0"); }
    
    // Format time in 12-hour format
    function formatTime(d){
      try{
        const h = d.getHours();
        const m = d.getMinutes();
        const ampm = h >= 12 ? "PM" : "AM";
        const hh = h % 12 || 12;
        return `${hh}:${pad2(m)} ${ampm}`;
      }catch(e){
        return "";
      }
    }
    
    // Format date as mm/dd/yyyy
    function formatDateMMDDYYYY(date) {
      const mm = pad2(date.getMonth() + 1);
      const dd = pad2(date.getDate());
      const yyyy = date.getFullYear();
      return `${mm}/${dd}/${yyyy}`;
    }
    
    // Auto-format date input with slashes
    function formatDateInput(input) {
      let value = input.value.replace(/\D/g, '');
      
      if (value.length > 2) {
        value = value.substring(0, 2) + '/' + value.substring(2);
      }
      if (value.length > 5) {
        value = value.substring(0, 5) + '/' + value.substring(5, 9);
      }
      
      input.value = value;
    }
    
    function toNum(v){
      const n = parseFloat(v);
      return Number.isFinite(n) ? n : 0;
    }

    // ---------------------------
    // Page Navigation System
    // ---------------------------
    function showPage(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      // Show the requested page
      document.getElementById(pageId).classList.add('active');
      
      // Update header info
      updateHeaderInfo(pageId);
    }
    
    function updateHeaderInfo(pageId) {
      const headerInfoMap = {
        'pageOpening': 'openingHeaderInfo',
        'pageMid': 'midHeaderInfo',
        'pageClosing': 'closingHeaderInfo'
      };
      
      const headerId = headerInfoMap[pageId];
      if (headerId && userData.store && userData.date && userData.name) {
        const headerElement = document.getElementById(headerId);
        if (headerElement) {
          headerElement.textContent = `${userData.store} • ${userData.date} • ${userData.name}`;
        }
      }
    }

    // ---------------------------
    // Initialize Page 1
    // ---------------------------
    function initializePage1() {
      const $date = document.getElementById("date");
      const $name = document.getElementById("name");
      const $store = document.getElementById("store");

      // Set today's date in mm/dd/yyyy format
      (function(){
        const now = new Date();
        $date.value = formatDateMMDDYYYY(now);
        userData.date = $date.value;
      })();

      // Load saved name and store
      const savedName = localStorage.getItem(LS_NAME_KEY);
      const savedStore = localStorage.getItem(LS_STORE_KEY);
      
      if(savedName) {
        $name.value = savedName;
        userData.name = savedName;
      }
      
      if(savedStore) {
        $store.value = savedStore;
        userData.store = savedStore;
      }

      $name.addEventListener("input", () => {
        userData.name = $name.value.trim();
        localStorage.setItem(LS_NAME_KEY, userData.name);
      });

      $store.addEventListener("change", () => {
        userData.store = $store.value;
        localStorage.setItem(LS_STORE_KEY, userData.store);
      });

      // Operation buttons - auto jump on click
      const operationButtons = Array.from(document.querySelectorAll(".pill[data-operation]"));
      
      operationButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          if (!userData.name.trim()) {
            alert("Please enter your name.");
            document.getElementById("name").focus();
            return;
          }
          
          userData.operation = btn.dataset.operation;
          
          // Navigate to the appropriate page
          if (userData.operation === "opening") {
            showPage("pageOpening");
            resetOpeningPage();
          } else if (userData.operation === "mid") {
            showPage("pageMid");
            resetMidPage();
          } else if (userData.operation === "closing") {
            showPage("pageClosing");
            resetClosingPage();
          }
        });
      });
    }

    // ---------------------------
    // Page 2: Opening Operation
    // ---------------------------
    function initializeOpeningPage() {
      // Back button
      document.getElementById("btnBackOpening").addEventListener("click", () => {
        showPage("page1");
      });

      // ---------------------------
// Focus SKU closed dropdown for opening
// ---------------------------
const closedSelectsOpening = Array.from(document.querySelectorAll("#pageOpening .closedSelect[data-seg]"));
const segStateOpening = {
  fp1_closed: "No",
  fp2_closed: "No",
  fp3_closed: "No"
};

function updateSegStateOpening(groupKey, val){
  segStateOpening[groupKey] = val;
}

// Initialize all to "No" and set up event listeners
closedSelectsOpening.forEach(select => {
  const key = select.dataset.seg;
  select.value = "No"; // Set default value to "No"
  updateSegStateOpening(key, "No");
  
  select.addEventListener("change", (e) => {
    updateSegStateOpening(key, e.target.value);
  });
});

      // ---------------------------
      // Checklist status text for opening
      // ---------------------------
      const mainChecksOpening = [
        ["env_main", "env_status"],
        ["sys_main", "sys_status"],
        ["clean_main", "clean_status"],
        ["bsf_main", "bsf_status"]
      ];

      function updateStatusOpening(mainId, statusId){
        const main = document.getElementById(mainId);
        const st = document.getElementById(statusId);
        if(!main || !st) return;

        if(main.checked){
          const now = new Date();
          st.textContent = `Completed at ${formatTime(now)}`;
          st.dataset.completedAt = now.toISOString();
        }else{
          st.textContent = "Not done";
          delete st.dataset.completedAt;
        }
      }

      mainChecksOpening.forEach(([m,s]) => {
        const el = document.getElementById(m);
        if(!el) return;
        el.addEventListener("change", () => updateStatusOpening(m,s));
        updateStatusOpening(m,s);
      });

      // ---------------------------
      // Freezer issue sub-options
      // ---------------------------
      const freezerIssueCheck = document.getElementById("freezer_issue");
      const freezerSubOptions = document.getElementById("freezer_suboptions");
      const freezerOtherText = document.getElementById("freezer_other_text");
      
      freezerIssueCheck.addEventListener("change", function() {
        freezerSubOptions.style.display = this.checked ? "block" : "none";
        if (!this.checked) {
          // Uncheck all freezer problem options
          document.querySelectorAll('input[name="freezer_problem"]').forEach(radio => {
            radio.checked = false;
          });
          freezerOtherText.style.display = "none";
          freezerOtherText.value = "";
        }
      });
      
      // Show other text input when "other" is selected
      document.querySelectorAll('input[name="freezer_problem"]').forEach(radio => {
        radio.addEventListener("change", function() {
          freezerOtherText.style.display = (this.value === "other") ? "block" : "none";
          if (this.value !== "other") {
            freezerOtherText.value = "";
          }
        });
      });

      // ---------------------------
      // Label missing text field
      // ---------------------------
      const labelMissingChk = document.getElementById("label_missing_chk");
      const labelMissingText = document.getElementById("label_missing_text");
      
      labelMissingChk.addEventListener("change", function() {
        labelMissingText.disabled = !this.checked;
        if (!this.checked) {
          labelMissingText.value = "";
        }
      });

      // ---------------------------
      // Delivery EXP toggle
      // ---------------------------
      const expChk = document.getElementById("exp_hasIssue");
      const expPanel = document.getElementById("exp_panel");

      function syncExpPanel(){
        const on = expChk.checked;
        expPanel.classList.toggle("show", on);
      }

      expChk.addEventListener("change", syncExpPanel);
      syncExpPanel(); // Initialize

      // ---------------------------
      // Date auto-format for EXP fields
      // ---------------------------
      document.querySelectorAll('.date-format').forEach(input => {
        input.addEventListener('input', function() {
          formatDateInput(this);
        });
        
        input.addEventListener('keydown', function(e) {
          // Allow navigation keys
          if ([8, 9, 13, 37, 39].includes(e.keyCode)) return;
          
          // Only allow numbers
          if (!/\d/.test(e.key) && e.keyCode !== 191) { // 191 is slash key
            e.preventDefault();
          }
        });
      });

      // ---------------------------
      // Send button for Opening
      // ---------------------------
      document.getElementById("btnSendOpening").addEventListener("click", () => {
        // Label missing must be filled if checked
        const labelMissingChk = document.getElementById("label_missing_chk");
        const labelMissingText = document.getElementById("label_missing_text");
        if(labelMissingChk.checked && !labelMissingText.value.trim()){
          alert("Please fill in items for: Label missing.");
          labelMissingText.focus();
          return;
        }

        // EXP must be filled if checked
        if(expChk.checked){
          for(let i=1; i<=5; i++){
            const sku = document.getElementById(`exp_sku${i}`);
            const exp = document.getElementById(`exp_exp${i}`);
            if(sku && sku.value.trim() && exp && !exp.value.trim()){
              alert(`Please fill EXP for SKU ${i}.`);
              exp.focus();
              return;
            }
          }
        }
        
        // Freezer issue must have a selection if checked
        if (document.getElementById("freezer_issue").checked) {
          const freezerProblem = document.querySelector('input[name="freezer_problem"]:checked');
          if (!freezerProblem) {
            alert("Please select a freezer issue type.");
            return;
          }
          if (freezerProblem.value === "other" && !document.getElementById("freezer_other_text").value.trim()) {
            alert("Please specify the other freezer issue.");
            document.getElementById("freezer_other_text").focus();
            return;
          }
        }

        // Build and send message
        sendWhatsAppMessage("opening");
      });
    }

    // ---------------------------
    // Reset Opening Page
    // ---------------------------
    function resetOpeningPage() {
      // Reset all form fields
      document.querySelectorAll('#pageOpening input[type="text"], #pageOpening input[type="number"]').forEach(input => {
        if (input.id !== 'exp_hasIssue') {
          input.value = '';
        }
      });
      
      // Reset checkboxes
      document.querySelectorAll('#pageOpening input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // Reset dropdowns to "No"
document.querySelectorAll('#pageClosing .closedSelect[data-seg]').forEach(select => {
  select.value = "No";
});
      
      // Reset status
      document.querySelectorAll('#pageOpening .status').forEach(status => {
        status.textContent = 'Not done';
      });
      
      // Reset EXP panel
      document.getElementById('exp_hasIssue').checked = false;
      document.getElementById('exp_panel').classList.remove('show');
      
      // Reset freezer issue
      document.getElementById('freezer_issue').checked = false;
      document.getElementById('freezer_suboptions').style.display = 'none';
      document.querySelectorAll('input[name="freezer_problem"]').forEach(radio => {
        radio.checked = false;
      });
      document.getElementById('freezer_other_text').style.display = 'none';
      document.getElementById('freezer_other_text').value = '';
      
      // Reset label missing
      document.getElementById('label_missing_chk').checked = false;
      document.getElementById('label_missing_text').disabled = true;
      document.getElementById('label_missing_text').value = '';
    }

    // ---------------------------
    // Page 3: Mid Operation
    // ---------------------------
    function initializeMidPage() {
      // Back button
      document.getElementById("btnBackMid").addEventListener("click", () => {
        showPage("page1");
      // Today's Receiving Status toggle (Mid)
const expChkMid = document.getElementById("exp_hasIssue_mid");
const expPanelMid = document.getElementById("exp_panel_mid");

if (expChkMid && expPanelMid) {
  expChkMid.addEventListener("change", () => {
    expPanelMid.classList.toggle("show", expChkMid.checked);
  });
}
      });

      // ---------------------------
      // Mid shift checklist with auto timestamp
      // ---------------------------
      const midCheckItems = [
        {id: "mid_bin", timeId: "mid_bin_time", label: "Bin is re-organized"},
        {id: "mid_shelf", timeId: "mid_shelf_time", label: "Shelf is re-organized"},
        {id: "mid_freezer", timeId: "mid_freezer_time", label: "Freezer is re-organized"},
        {id: "mid_floor", timeId: "mid_floor_time", label: "Floor is cleaned"},
        {id: "mid_counter", timeId: "mid_counter_time", label: "Counter has no trash"},
        {id: "mid_freezers_working", timeId: "mid_freezers_working_time", label: "Freezers are working"}
      ];
      
      midCheckItems.forEach(item => {
        const checkbox = document.getElementById(item.id);
        const timeElement = document.getElementById(item.timeId);
        
        checkbox.addEventListener("change", function() {
          if (this.checked) {
            timeElement.textContent = formatTime(new Date());
          } else {
            timeElement.textContent = "";
          }
        });
      });

      // ---------------------------
      // Send button for Mid
      // ---------------------------
      document.getElementById("btnSendMid").addEventListener("click", () => {
        sendWhatsAppMessage("mid");
      });
    }

    // ---------------------------
    // Reset Mid Page
    // ---------------------------
    function resetMidPage() {
      // Reset all checkboxes and timestamps
      document.querySelectorAll('#pageMid input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      document.querySelectorAll('#pageMid .mid-time').forEach(timeEl => {
        timeEl.textContent = '';
      });
    }

    // ---------------------------
    // Page 4: Closing Operation
    // ---------------------------
    function initializeClosingPage() {
      // Back button
      document.getElementById("btnBackClosing").addEventListener("click", () => {
        showPage("page1");
        // Today's Receiving Status toggle (Closing)
const expChkClosing = document.getElementById("exp_hasIssue_closing");
const expPanelClosing = document.getElementById("exp_panel_closing");

if (expChkClosing && expPanelClosing) {
  expChkClosing.addEventListener("change", () => {
    expPanelClosing.classList.toggle("show", expChkClosing.checked);
  });
}
      });

      // ---------------------------
// Focus SKU closed dropdown for closing
// ---------------------------
const closedSelectsClosing = Array.from(document.querySelectorAll("#pageClosing .closedSelect[data-seg]"));
const segStateClosing = {
  fp1_closed_closing: "No",
  fp2_closed_closing: "No",
  fp3_closed_closing: "No"
};

function updateSegStateClosing(groupKey, val){
  segStateClosing[groupKey] = val;
}

// Initialize all to "No"
closedSelectsClosing.forEach(select => {
  const key = select.dataset.seg;
  select.value = "No"; // Set default value to "No"
  updateSegStateClosing(key, "No");
  
  select.addEventListener("change", (e) => {
    updateSegStateClosing(key, e.target.value);
  });
});

      // ---------------------------
      // Checklist status text for closing
      // ---------------------------
      const mainChecksClosing = [
        ["things_off_main", "things_off_status"],
        ["freezer_on_main", "freezer_on_status"],
        ["freezers_not_working_main", "freezers_not_working_status"],
        ["trash_main_closing", "trash_status_closing"],
        ["sup_main_closing", "sup_status_closing"]
      ];

      function updateStatusClosing(mainId, statusId){
        const main = document.getElementById(mainId);
        const st = document.getElementById(statusId);
        if(!main || !st) return;

        if(main.checked){
          const now = new Date();
          st.textContent = `Completed at ${formatTime(now)}`;
          st.dataset.completedAt = now.toISOString();
        }else{
          st.textContent = "Not done";
          delete st.dataset.completedAt;
        }
      }

      mainChecksClosing.forEach(([m,s]) => {
        const el = document.getElementById(m);
        if(!el) return;
        el.addEventListener("change", () => updateStatusClosing(m,s));
        updateStatusClosing(m,s);
      });

      // ---------------------------
      // Cash auto difference
      // ---------------------------
      const $drawer = document.getElementById("drawerCash");
      const $system = document.getElementById("systemCashSales");
      const $diff = document.getElementById("differenceValue");

      function updateDifference(){
        const drawer = toNum($drawer.value);
        const system = toNum($system.value);
        const diff = drawer - system;
        $diff.textContent = `$${diff.toFixed(2)}`;
        $diff.dataset.value = diff.toFixed(2);
      }
      
      $drawer.addEventListener("input", updateDifference);
      $system.addEventListener("input", updateDifference);
      updateDifference();

      // ---------------------------
      // Send button for Closing
      // ---------------------------
      document.getElementById("btnSendClosing").addEventListener("click", () => {
        // Cash fields should be filled
        if (!$drawer.value.trim() || !$system.value.trim()) {
          alert("Please fill in cash drawer and system cash sales.");
          if (!$drawer.value.trim()) $drawer.focus();
          else $system.focus();
          return;
        }

        sendWhatsAppMessage("closing");
      });
    }

    // ---------------------------
    // Reset Closing Page
    // ---------------------------
    function resetClosingPage() {
      // Reset all form fields
      document.querySelectorAll('#pageClosing input[type="text"], #pageClosing input[type="number"]').forEach(input => {
        input.value = '';
      });
      
      // Reset checkboxes
      document.querySelectorAll('#pageClosing input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      // Reset dropdowns to "No"
document.querySelectorAll('#pageOpening .closedSelect[data-seg]').forEach(select => {
  select.value = "No";
});
      
      // Reset status
      document.querySelectorAll('#pageClosing .status').forEach(status => {
        status.textContent = 'Not done';
      });
      
      // Reset cash difference
      document.getElementById('differenceValue').textContent = '$0.00';
      document.getElementById('differenceValue').dataset.value = '0.00';
    }

    // ---------------------------
    // WhatsApp Message Builder
    // ---------------------------
    function sendWhatsAppMessage(operationType) {
      const msg = buildMessage(operationType);
      const url = `https://wa.me/${WA_PHONE}?text=${encodeURIComponent(msg)}`;
      window.open(url, "_blank");
      
      // After sending, reset the current page and go back to home
      setTimeout(() => {
        if (operationType === "opening") {
          resetOpeningPage();
        } else if (operationType === "mid") {
          resetMidPage();
        } else if (operationType === "closing") {
          resetClosingPage();
        }
        showPage("page1");
      }, 500);
    }

    function buildMessage(operationType) {
      const lines = [];

      // Header
      lines.push(`PG Daily Log`);
      lines.push(`Store: ${userData.store}`);
      lines.push(`Date: ${userData.date}`);
      lines.push(`Name: ${userData.name}`);
      lines.push(`Operation: ${userData.operation === "opening" ? "Opening" : userData.operation === "mid" ? "12–5pm" : "Closing"}`);
      lines.push(``);

      if (operationType === "opening") {
        // Focus SKUs for opening
        const fp = [
          {sku:"SKU 1", reco: document.getElementById("fp1_reco").value ?? "0", closed: getSegState("fp1_closed", "Opening")},
          {sku:"SKU 2", reco: document.getElementById("fp2_reco").value ?? "0", closed: getSegState("fp2_closed", "Opening")},
          {sku:"SKU 3", reco: document.getElementById("fp3_reco").value ?? "0", closed: getSegState("fp3_closed", "Opening")},
        ];

        const expHasIssue = document.getElementById("exp_hasIssue").checked;

        const delivery = [1,2,3,4,5].map(i => ({
          sku: (document.getElementById(`exp_sku${i}`)?.value || "").trim(),
          exp: (document.getElementById(`exp_exp${i}`)?.value || "").trim()
        }));

        const envDetails = listCheckedDetails("env", "pageOpening");
        const sysDetails = listCheckedDetails("sys", "pageOpening");

        const envDone = document.getElementById("env_main").checked;
        const sysDone = document.getElementById("sys_main").checked;
        const cleanDone = document.getElementById("clean_main").checked;
        const bsfDone = document.getElementById("bsf_main").checked;

        const labelMissingChecked = document.getElementById("label_missing_chk").checked;
        const labelMissingVal = (document.getElementById("label_missing_text").value || "").trim();

        // Focus SKUs
        lines.push(`Focus SKUs`);
        fp.forEach(x => {
          const reco = (x.reco === "" ? "0" : x.reco);
          lines.push(`${x.sku} — Recommend: ${reco} | Closed: ${x.closed}`);
        });
        lines.push(``);

        // Delivery (only if checked)
        lines.push(`Delivery Expiry Check (EXP ≤ 8 months)`);
        lines.push(`Found items: ${expHasIssue ? "Yes" : "No"}`);

        if(expHasIssue){
          delivery.forEach((d, idx) => {
            if(d.sku || d.exp){
              lines.push(`SKU ${idx+1} — ${d.sku} | EXP: ${d.exp}`);
            }
          });
        }
        lines.push(``);

        // Checklist summary
        function doneText(b){ return b ? "Done" : "Not done"; }

        lines.push(`Checklist`);
        lines.push(`Environment Normal: ${doneText(envDone)}`);
        if(envDetails.length) lines.push(`- Issues: ${envDetails.join(", ")}`);
        
        // Freezer issue details
        if (document.getElementById("freezer_issue").checked) {
          const freezerProblem = document.querySelector('input[name="freezer_problem"]:checked');
          if (freezerProblem) {
            let problemText = freezerProblem.value;
            if (freezerProblem.value === "other" && document.getElementById("freezer_other_text").value.trim()) {
              problemText = `Other: ${document.getElementById("freezer_other_text").value.trim()}`;
            }
            lines.push(`- Freezer issue: ${problemText}`);
          }
        }
        
        lines.push(`- Label missing checked: ${labelMissingChecked ? "Yes" : "No"}`);
        if(labelMissingVal) lines.push(`- Label missing: ${labelMissingVal}`);

        lines.push(`System Normal: ${doneText(sysDone)}`);
        if(sysDetails.length) lines.push(`- Issues: ${sysDetails.join(", ")}`);

        lines.push(`Cleaning Check: ${doneText(cleanDone)}`);
        lines.push(`Bin, Shelf & Freezer Ready: ${doneText(bsfDone)}`);

      } else if (operationType === "mid") {
        // Mid shift checklist
        lines.push(`Checklist`);
        const midItems = [
          {id: "mid_bin", timeId: "mid_bin_time", label: "Bin is re-organized"},
          {id: "mid_shelf", timeId: "mid_shelf_time", label: "Shelf is re-organized"},
          {id: "mid_freezer", timeId: "mid_freezer_time", label: "Freezer is re-organized"},
          {id: "mid_floor", timeId: "mid_floor_time", label: "Floor is cleaned"},
          {id: "mid_counter", timeId: "mid_counter_time", label: "Counter has no trash"},
          {id: "mid_freezers_working", timeId: "mid_freezers_working_time", label: "Freezers are working"}
        ];
        
        midItems.forEach(item => {
          const checkbox = document.getElementById(item.id);
          const timeElement = document.getElementById(item.timeId);
          lines.push(`${item.label}: ${checkbox.checked ? `Done at ${timeElement.textContent}` : 'Not done'}`);
        });
        
      } else if (operationType === "closing") {
        // Focus SKUs for closing
        const fpClosing = [
          {sku:"SKU 1", reco: document.getElementById("fp1_reco_closing").value ?? "0", closed: getSegState("fp1_closed_closing", "Closing")},
          {sku:"SKU 2", reco: document.getElementById("fp2_reco_closing").value ?? "0", closed: getSegState("fp2_closed_closing", "Closing")},
          {sku:"SKU 3", reco: document.getElementById("fp3_reco_closing").value ?? "0", closed: getSegState("fp3_closed_closing", "Closing")},
        ];

        const thingsOffDone = document.getElementById("things_off_main").checked;
        const freezerOnDone = document.getElementById("freezer_on_main").checked;
        const freezersNotWorkingDone = document.getElementById("freezers_not_working_main").checked;
        const trashDoneClosing = document.getElementById("trash_main_closing").checked;
        const supDoneClosing = document.getElementById("sup_main_closing").checked;
        
        const supDetailsClosing = listCheckedDetails("sup", "pageClosing");

        const drawer = document.getElementById("drawerCash").value.trim();
        const systemSales = document.getElementById("systemCashSales").value.trim();
        const diffVal = document.getElementById("differenceValue").dataset.value ?? "";

        // Focus SKUs
        lines.push(`Focus SKUs`);
        fpClosing.forEach(x => {
          const reco = (x.reco === "" ? "0" : x.reco);
          lines.push(`${x.sku} — Recommend: ${reco} | Closed: ${x.closed}`);
        });
        lines.push(``);

        // Checklist summary
        function doneText(b){ return b ? "Done" : "Not done"; }

        lines.push(`Checklist`);
        lines.push(`Things OFF: ${doneText(thingsOffDone)}`);
        lines.push(`Freezers On: ${doneText(freezerOnDone)}`);
        lines.push(`Freezers Abnormal: ${doneText(freezersNotWorkingDone)}`);
        lines.push(`Trash Out: ${doneText(trashDoneClosing)}`);
        lines.push(`Supplies Check: ${doneText(supDoneClosing)}`);
        if(supDetailsClosing.length) lines.push(`- Issues: ${supDetailsClosing.join(", ")}`);
        lines.push(``);

        // Cash
        lines.push(`Cash`);
        lines.push(`Drawer Cash: ${drawer}`);
        lines.push(`System Cash Sales: ${systemSales}`);
        lines.push(`Difference: ${diffVal}`);
      }

      return lines.join("\n");
    }

    // Helper functions for message building
    function getSegState(key, page) {
  // Find the corresponding dropdown menu based on page and key
  const select = document.querySelector(`#page${page} .closedSelect[data-seg="${key}"]`);
  return select ? select.value : "No";
}
    function listCheckedDetails(detailKey, pageId){
      const nodes = Array.from(document.querySelectorAll(`#${pageId} input[type="checkbox"][data-detail="${detailKey}"]`));
      const vals = nodes.filter(n => n.checked).map(n => n.value);
      return vals;
    }

    // ---------------------------
    // Initialize All Pages
    // ---------------------------
    document.addEventListener('DOMContentLoaded', function() {
      initializePage1();
      initializeOpeningPage();
      initializeMidPage();
      initializeClosingPage();
      
      // Initialize with page 1
      showPage("page1");
    });
 
    // ---------------------------
    // Service worker (optional)
    // ---------------------------
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }
  </script>
</body>
</html>